---
date: "20250901"
docx:
  - LNMP搭建部署.docx
  - Tomcat管理及线程池.docx
实验: 已做
---
[LNMP搭建部署.docx](附件/6-LNMP搭建部署.docx)
[tomcat管理及线程池.docx](附件/tomcat/8-tomcat管理及线程池.docx)


# LNMP搭建部署
## 笔记

==LNMP介绍==

>![[Pasted image 20250904104700.png]]
>
各部分的作用
>![[Pasted image 20250904104824.png]]
>
FastCGI作用
>![[Pasted image 20250904104939.png]]
 
 ==概念介绍==
 
>CGI、FastCGI及其软件 ![[Pasted image 20250904112514.png]]
>
CGI工作流程
>![[Pasted image 20250904112736.png]]
>
FastCGI工作流程
>![[Pasted image 20250904112949.png]]
FastCGI进程管理器
CGI解释器进程
>
>![[c4a431761f60795f541c1c178a701a6f.jpg]]

==源码安装LNMP==

==部署博客和论坛==
## 实验
### LNMP搭建

lnmp全安装在一台机器=》4G
![[Pasted image 20251010172249.png]]
#### 源码安装nginx

>nginx依赖
>yum -y install pcre-devel zlib-devel openssl-devel elinks geoip-devel php-gd gd-devel gcc


![[Pasted image 20251010172303.png]]
![[Pasted image 20251010190037.png]]
效果：
![[Pasted image 20251010211812.png]]
#### 二进制安装mysql

![[Pasted image 20251010182020.png]]
/etc/my.cnf
![[Pasted image 20251010182206.png]]
![[Pasted image 20251010182242.png]]

![[Pasted image 20251010182305.png]]


![[Pasted image 20251010182327.png]]
![[Pasted image 20251010182430.png]]
![[Pasted image 20251010212006.png]]


#### 源码安装php
![[Pasted image 20251010182657.png]]
源码安装php   解压、配置、编译、安装
创建链接：
![[Pasted image 20251010184219.png]]
![[Pasted image 20251010184702.png]]
三个配置文件：
![[Pasted image 20251010183957.png]]
![[Pasted image 20251010184252.png]]

![[Pasted image 20251010184344.png]]
![[Pasted image 20251010184419.png]]

![[Pasted image 20251010184452.png]]
不用动

创建用户：
![[Pasted image 20251010184733.png]]

启动：
php-fpm
效果：
![[Pasted image 20251010213503.png]]
#### niginx转发php
nginx.conf
![[Pasted image 20251014190234.png]]
![[Pasted image 20251010185054.png]]
![[Pasted image 20251010185115.png]]
![[Pasted image 20251010185153.png]]
![[Pasted image 20251010185215.png]]
### 部署博客和论坛
![[Pasted image 20251011190050.png]]

![[Pasted image 20251011190101.png]]
## 补充
==LNMP的工作流程==
**LNMP** 架构里：

- **Nginx**：只负责接收 HTTP 请求、处理静态资源和转发 PHP 请求给 PHP-FPM，不直接和数据库交互。
    
- **PHP-FPM**：作为应用服务器，解析 PHP 脚本，如果脚本里有数据库操作，它直接通过 MySQL 的 TCP 或 Unix Socket 与数据库交互。
    
- **MySQL**：提供数据存储服务，只和 PHP-FPM 通信，Nginx 不知道数据库的存在。
    

所以整个访问链路是：

`浏览器 → Nginx → PHP-FPM → MySQL`

Nginx 是“入口”，PHP-FPM 是“业务逻辑处理”，MySQL 是“数据存储”。

这也是 LNMP 能高效分工的原因：Web 层、应用层、数据库层完全解耦。

==web服务搭建的架构角色==

HTTP Server

它们是：

- **Web 服务器（HTTP Server）**
    
    - 负责处理 HTTP 请求，返回静态资源
        
    - 可作为 **反向代理、负载均衡器**
        
    - 代表：
        
        - **Nginx**
            
        - **Apache HTTP Server**
            
        - **Lighttpd**
            
        - **Caddy**（新兴的轻量 Web 服务器，自动 HTTPS）

---


APP Server

**应用服务器 / 动态应用运行环境**

- 负责运行动态应用逻辑，生成动态页面
    
- 代表：
    
    - **Tomcat**（Java Web 容器）
        
    - **PHP-FPM**（PHP 解释器的 FastCGI 进程管理器）
        
    - **Node.js**（JS 应用服务器）
        
    - **Gunicorn / uWSGI**（Python WSGI 应用服务器）
        
    - **JBoss / WildFly / WebLogic / WebSphere**（更完整的 Java EE 应用服务器）

---

常见架构名称

- **LAMP**：Linux + Apache + MySQL + PHP
- **LNMP**：Linux + Nginx + MySQL + PHP
- **LEMP**：Linux + (Nginx 读音 EngineX) + MySQL/MariaDB + PHP
    
- **Java 架构**：Nginx + Tomcat + MySQL（没有固定缩写，但 Spring MVC、Spring Boot 常用）
- **MEAN**：MongoDB + Express + Angular + Node.js
- **MERN**：MongoDB + Express + React + Node.js

>-前三钟强调是linux
> 后三种不强调操作系统
>
>- LAMP / LNMP / LEMP → 强调“Linux + Web 服务器 + 数据库 + 动态语言”这种 **Linux 平台下的经典组合**。
    >
>- Java 架构 (Nginx + Tomcat + MySQL) → 同类概念，但大家习惯直接说 **Java Web 架构**，不常有固定缩写。
>    
>- MEAN / MERN → 强调的是 **前后端一体化的 Node.js 技术栈**，跟操作系统无关。


>**还有其他组合吗**？
>主流就这几类：
> Web 服务器：Nginx、Apache、Caddy、Lighttpd
> 应用服务器：Tomcat、JBoss、Node.js、PHP-FPM、Gunicorn
> 数据库：MySQL、PostgreSQL、MongoDB
>其他组合确实存在，但相对 **小众** 或 **专用场景**。
>


>mysql安装包名称
如果是源码包，一般会叫：
`mysql-x.x.x.tar.gz`
>
>
 MySQL 的预编译二进制包
`mysql-x.x.x-linux-glibcX.x-x86_64.tar.gz`
>
解压注意
可以先用 `tar -tf 包名.tar.gz`或`unzip -l file.zip` 查看压缩包结构，是否有顶层目录，再决定解压方式


==nginx安装的问题有哪些？==


>这里写的有问题，以root身份运行的编译文件到/opt/nginx里，文件属主属组都是root；
所以应该添加：
>- 修改运行时目录权限给 nginx 用户：
    chown -R nginx:nginx /opt/nginx/logs 
    chown -R nginx:nginx /opt/nginx/html 
    chown -R nginx:nginx /var/lib/nginx/`
>- 保持配置目录 `/opt/nginx/conf/` 和二进制文件 `/opt/nginx/sbin/nginx` 属主为 root。  
    因为这些需要 root 才能执行或修改。
>总结就是全部安装好以后再修改权限

>编译参数--user/group、配置文件user的关系？
>两者都是控制work进程身份
>`user nginx` 是 Nginx 配置文件中控制 worker 进程运行身份 的指令，但优先级更高

>**nginx和root用户权限；**
>- root 管理程序和配置> 
>- nginx 管理运行时数据（日志、临时文件）
>
>**nginx的命令：**
>`sbin/` 目录下 就一个可执行文件：`nginx`。  
Nginx 本身只有一个主命令，所有的操作（启动、停止、重载、测试配置）都靠它一个完成。


>创建链接时：
>`/usr/local/bin` 给普通程序，  
`/usr/local/sbin` 给系统级服务（如 nginx、mysql、sshd）

```
nginx安装后的默认权限
安装完成后所有的安装目录文件都是默认的root用户和组，权限也是默认的755和644；
原因：
是谁执行 make install，安装产物就归谁所有

- 你是 `root` 用户执行的，所以安装出来的目录、文件的 属主/属组 默认就是 `root:root`
程序目录（root 管理），权限也是默认的数字；

```
>源码、二进制压缩包安装都需要手动创建用户；
>源码指定prefix

==mysql安装的相关问题？==


libaio软件包是什么？
>安装 libaio 后就可以在用户空间直接利用内核异步 I/O，而不需要自己写底层系统调用代码。
>初始化的工作
>basedir 是安装目录（初始化前就存在），datadir 是数据目录（初始化时生成系统数据库和相关文件），初始化的主要工作就在 datadir。
>使用mysql.server的优点
>不用记住pid来控制启动和停止；直接命令start、stop、restart

编译注意
>./configure只在执行configure脚本，产生Makefile文件
>- `make` → 读 Makefile 里的 `all` 目标（编译）。
>- `make install` → 读 Makefile 里的 `install` 目标（安装）。
>- 两者都依赖 Makefile，所以一般都在源码的根目录下执行。


三种启动方式

| 启动方式                          | 核心依赖           | 主要功能               | 特殊功能                      |
| ----------------------------- | -------------- | ------------------ | ------------------------- |
| **mysqld**（/usr/sbin/mysqld ） | 自身             | 数据库核心功能（存储、查询、协议等） | 无监控，无自动重启                 |
| **mysqld_safe**               | 调用 mysqld      | 数据库核心功能            | 进程异常监控 + 自动重启             |
| **systemd/systemctl**         | 调用 mysqld（可配置） | 数据库核心功能            | 进程监控、自动重启、开机自启、依赖管理、日志管理等 |

所以从功能数量上确实是：

`mysqld < mysqld_safe < systemctl/systemd`

底层核心功能都是 **mysqld**，只是包装和附加管理能力不同

**mysql.server脚本本质是mysql_safe**

>用户配置：
>**最推荐稳妥做法**：
>1. 创建 mysql 系统用户
>2. 初始化数据目录时用 `--user=mysql`
>3. 启动/停止/重载都用 `mysql.server`
>4. `[mysqld]` 里配置 `user=mysql`，mysqld_safe 会读取my.cnf

==安装php的相关问题？==


>你不指定 `--prefix` 时,默认安装路径是：
`/usr/local/
它会在 `/usr/local` 下自动创建一个 `nginx/` 子目录


>- php-fpm 默认启动一个 master + 多个 worker。
>- master 进程保持 root 权限（可绑定低端口），worker 则切换到池用户（如 www），保证安全性。
>- `php-fpm.conf` 决定全局行为，`www.conf` 决定每个池的用户、进程数、监听方式等。
也就是说，你看到的 `www` 用户就是 `www.conf` 里 `user` 和 `group` 的配置生效结果。
# Tomcat管理及线程池

## 笔记
==Tomcat管理功能使用==

==Tomcat线程池==

==WEB站点部署==

## 实验
### 管理功能开启
需要输入密码，也可以不设置
![[Pasted image 20251014190943.png]]
![[Pasted image 20251014191025.png]]
![[Pasted image 20251014191043.png]]
### tomcat线程池修改
![[Pasted image 20251014191147.png]]

Server
 └── Service
      ├── Connector(s)
      ├── Engine
      │    └── Host(s)
      │         └── Context(s)
      └── Executor(s)
Executor 是为多个 Connector 提供公共线程池的资源

### web站点部署

war包部署
![[Pasted image 20251014192453.png]]

另一种是目录直接放进去