---
date: "1014"
docx:
å®éªŒ:
---
![[Pasted image 20251014111345.png]]
# 09-æ¦‚å¿µ

## ç¬”è®°
![[Pasted image 20251020090640.png]]
==èƒŒæ™¯ä»‹ç»==
![[Pasted image 20251020091324.png]]
![[Pasted image 20251020091632.png]]

è™šæ‹ŸåŒ–å’Œå®¹å™¨åŒ–çš„æ ¸å¿ƒå¼‚åŒç‚¹ï¼š
å…±åŒç‚¹ï¼š

| ç‰¹æ€§      | è¯´æ˜                            |
| ------- | ----------------------------- |
| éš”ç¦»åº”ç”¨    | æ— è®ºæ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯å®¹å™¨ï¼Œè¿è¡Œçš„åº”ç”¨å½¼æ­¤éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°     |
| æé«˜èµ„æºåˆ©ç”¨ç‡ | å……åˆ†åˆ©ç”¨ CPUã€å†…å­˜ã€å­˜å‚¨ç­‰ç‰©ç†èµ„æºï¼Œå®ç°å¤šåº”ç”¨å¹¶è¡Œè¿è¡Œ |
ä¸åŒç‚¹ï¼š

| ç‰¹æ€§   | è™šæ‹ŸåŒ– (VM)                               | å®¹å™¨åŒ– (Container)                |
| ---- | -------------------------------------- | ------------------------------ |
| éš”ç¦»å±‚çº§ | ç¡¬ä»¶å±‚ï¼ˆCPUã€å†…å­˜ã€è®¾å¤‡ï¼‰                         | OS / è¿›ç¨‹å±‚ï¼ˆNamespaceã€cgroupï¼‰     |
| éš”ç¦»ä¾èµ– | è™šæ‹ŸåŒ–å¹³å°/Hypervisorï¼ˆå¦‚ VMwareã€KVMã€Hyper-Vï¼‰ | å®¹å™¨è¿è¡Œæ—¶ï¼ˆDockerã€containerdã€CRI-Oï¼‰ |
| è¿è¡Œå•ä½ | è™šæ‹Ÿæœºï¼ˆVMï¼‰                                | å®¹å™¨ï¼ˆContainerï¼‰                  |
| å†…æ ¸å…±äº« | ä¸å…±äº«ï¼Œæ¯ä¸ª VM ç‹¬ç«‹æ“ä½œç³»ç»Ÿ                       | å…±äº«å®¿ä¸»æœºæ“ä½œç³»ç»Ÿå†…æ ¸                    |
| ç³»ç»Ÿå¼€é”€ | é«˜ï¼šæ¯ä¸ª VM éƒ½éœ€è¦å®Œæ•´ OS                       | ä½ï¼šå®¹å™¨è½»é‡ï¼Œå…±äº«å†…æ ¸ï¼Œå¯åŠ¨å¿«                |
| å¯åŠ¨æ—¶é—´ | æ•°åç§’åˆ°åˆ†é’Ÿçº§                                | æ¯«ç§’åˆ°ç§’çº§                          |
| åº”ç”¨éƒ¨ç½² | é€‚åˆå¤šæ ·åŒ– OS ç¯å¢ƒ                            | é€‚åˆå¿«é€Ÿéƒ¨ç½²ã€å¾®æœåŠ¡æ¶æ„                   |
**æ€»ç»“è®°å¿†ç‚¹**ï¼š

- **è™šæ‹ŸåŒ–** = æ¯ä¸ª VM æœ‰è‡ªå·±çš„ OSï¼Œéš”ç¦»å½»åº•ï¼Œä½†å¼€é”€å¤§
    
- **å®¹å™¨åŒ–** = å®¹å™¨å…±äº«å®¿ä¸» OS å†…æ ¸ï¼Œè½»é‡å¿«é€Ÿï¼Œé€‚åˆå¾®æœåŠ¡
==å®¹å™¨ä»‹ç»==
![[Pasted image 20251020092050.png]]
==ä»»åŠ¡ç¼–æ’==
![[Pasted image 20251020095057.png]]
==kubernetesæ¦‚è¿°==
![[Pasted image 20251020110017.png]]

![[Pasted image 20251020111636.png]]

![[Pasted image 20251020112032.png]]
==kubernetesç»„ä»¶ä»‹ç»==
![[Pasted image 20251020113835.png]] 
**masterï¼š**

api serverï¼šç»„ä»¶äº¤äº’

etcdï¼šæ•°æ®åº“

schedulerï¼špodè°ƒåº¦ä¸­å¿ƒ

controller managerï¼šç›‘æ§podï¼Œä¿®å¤pod

    node controllerï¼šç›‘æ§

    replication controllerï¼šç»´æŠ¤podæ•°é‡

    endpoint controllerï¼š

    service account & token controllerï¼š

Etcdï¼šå­˜å‚¨æ•°æ®ï¼Œå®¹å™¨è°ƒåº¦ï¼ŒèŠ‚ç‚¹ä¿¡æ¯ï¼Œå»ºè®®éƒ¨ç½²å¤§äº3ä¸ª+å¥‡æ•°ä¸ªetcd

**node**ï¼š
è¢«masteråˆ†é…å·¥ä½œè´Ÿè½½ï¼Œå½“æŸä¸ª Node å²©æœºæ—¶ï¼ŒNode ä¸Šçš„å·¥ä½œè´Ÿè½½ä¼šè¢« Master è‡ªåŠ¨è½¬ç§»åˆ°å…¶ ä»– Node èŠ‚ç‚¹ä¸Šå»ã€‚

kubeletï¼šä»£ç†æœåŠ¡ï¼Œä¸masteré€šä¿¡ï¼Œç®¡ç†podã€å®¹å™¨ã€é•œåƒã€volumeï¼Œå¯¹èŠ‚ç‚¹æ‰€æœ‰èµ„æºç®¡ç†

kube-proxyï¼špodä¹‹é—´é€šä¿¡+è´Ÿè½½å‡è¡¡ï¼›ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼šlpvsã€iptables

podï¼šcontaineré›†åˆ

containerï¼šå®¹å™¨

dockerï¼šå®¹å™¨ç®¡ç†ï¼Œå®¹å™¨æ“ä½œæ‰§è¡Œè€…

å…¶ä»–ï¼š

kubectlæ“ä½œmasterçš„å®¢æˆ·ç«¯

å¤–éƒ¨ç»„ä»¶ï¼š

corednsï¼ˆå†…éƒ¨åŸŸåï¼‰ã€calicoã€flannelï¼ˆpod ipï¼‰

dashboard

chatgptï¼š
![[Pasted image 20251020114630.png]]
Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶å¹³é¢ï¼‰

| ç»„ä»¶                          | ä½œç”¨                                                                   |     |
| --------------------------- | -------------------------------------------------------------------- | --- |
| **kube-apiserver**          | æ ¸å¿ƒ==äº¤äº’å…¥å£==ï¼Œæ‰€æœ‰ç»„ä»¶å’Œç”¨æˆ·éƒ½é€šè¿‡ API Server é€šä¿¡ï¼Œè´Ÿè´£éªŒè¯å’Œå¤„ç†è¯·æ±‚ï¼Œå­˜å‚¨çŠ¶æ€åˆ° etcd             |     |
| **kube-scheduler**          | æ ¹æ®èµ„æºã€ç­–ç•¥å’Œçº¦æŸï¼Œ==æŠŠæœªè°ƒåº¦çš„ Pod åˆ†é…åˆ°åˆé€‚çš„ Node==                                 |     |
| **kube-controller-manager** | ç®¡ç†å„ç§æ§åˆ¶å™¨ï¼ˆReplicaSetã€Deploymentã€Nodeã€Endpoint ç­‰ï¼‰ï¼Œ==ä¿è¯é›†ç¾¤çŠ¶æ€ç¬¦åˆæœŸæœ›==        |     |
| **etcd**                    | åˆ†å¸ƒå¼ key-value å­˜å‚¨==ï¼Œä¿å­˜é›†ç¾¤çŠ¶æ€==ï¼ˆPodsã€Nodesã€Config ç­‰ï¼‰ï¼Œæ˜¯ Kubernetes çš„â€œæ•°æ®åº“â€ |     |
Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰

| ç»„ä»¶             | ä½œç”¨                                                                          |
| -------------- | --------------------------------------------------------------------------- |
| **kubelet**    | ==Node ä¸Šçš„ä»£ç†ï¼Œç®¡ç† Pod ç”Ÿå‘½å‘¨æœŸï¼Œæ¥å— API Server æŒ‡ä»¤ï¼Œè°ƒç”¨å®¹å™¨è¿è¡Œæ—¶==ï¼ˆcontainerd æˆ– Dockerï¼‰å¯åŠ¨å®¹å™¨ |
| **kube-proxy** | ç®¡ç† Node ä¸Šçš„ ==Service ç½‘ç»œè§„åˆ™ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°==ï¼ˆClusterIPã€NodePortã€LoadBalancerï¼‰    |
| **å®¹å™¨è¿è¡Œæ—¶**      | è¿è¡Œ Pod å†…çš„å®¹å™¨ï¼ˆDocker Engineã€containerdã€CRI-O ç­‰ï¼‰                               |
| **Pod**        | ==æœ€å°è°ƒåº¦å•å…ƒ==ï¼Œå†…éƒ¨å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå…±äº«ç½‘ç»œå’Œå­˜å‚¨                                            |
|                |                                                                             |

==kubernetesèµ„æºå¯¹è±¡ï¼š==

![image-20251020115208650](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020115208650.png?lastModify=1760938892)

![image-20251020115435276](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020115435276.png?lastModify=1760938892)

![image-20251020115521294](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020115521294.png?lastModify=1760938892)

deploymentå¯åŠ¨podï¼Œrsä¿è¯podæ•°é‡

![image-20251020115716192](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020115716192.png?lastModify=1760938892)

serviceæä¾›è®¿é—®podæœåŠ¡

![image-20251020115904504](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020115904504.png?lastModify=1760938892)

![image-20251020120023918](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020120023918.png?lastModify=1760938892)

![image-20251020120128079](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020120128079.png?lastModify=1760938892)

![image-20251020120145686](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020120145686.png?lastModify=1760938892)

![image-20251020133514339](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020133514339.png?lastModify=1760938892)

![image-20251020133543343](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020133543343.png?lastModify=1760938892)

![image-20251020133742772](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020133742772.png?lastModify=1760938892)

![image-20251020134029060](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251020134029060.png?lastModify=1760938892)
## è¡¥å……

==è™šæ‹ŸåŒ–å’Œå®¹å™¨åŒ–åŒºåˆ«==ï¼Ÿ

éš”ç¦»çš„å±‚çº§ä¸åŒï¼šè™šæ‹ŸåŒ–éš”ç¦»çš„å†…æ ¸ä¹Ÿå°±æ˜¯éš”ç¦»çš„osï¼›dockeréš”ç¦»çš„æ˜¯è¿›ç¨‹ä¹Ÿå…±äº«oså†…æ ¸ï¼Œä¹Ÿå°±æ˜¯å…±äº«osï¼›

| å¯¹æ¯”é¡¹  | è™šæ‹ŸåŒ–ï¼ˆVMï¼‰                         | å®¹å™¨åŒ–ï¼ˆDockerï¼‰                          |
| ---- | ------------------------------- | ------------------------------------ |
| éš”ç¦»å±‚çº§ | ==æ“ä½œç³»ç»Ÿå±‚==                       | ==è¿›ç¨‹å±‚==                              |
| å†…æ ¸   | æ¯ä¸ª ==VM æ‹¥æœ‰ç‹¬ç«‹å†…æ ¸==ï¼ˆGuest OSï¼‰      | æ‰€æœ‰==å®¹å™¨å…±äº«å®¿ä¸»æœºå†…æ ¸==                      |
| å®ç°æœºåˆ¶ | Hypervisorï¼ˆKVMã€VMwareï¼‰==è™šæ‹Ÿå‡ºç¡¬ä»¶== | Linux Namespace + Cgroups ==éš”ç¦»è¿›ç¨‹ç¯å¢ƒ== |
| èµ„æºå¼€é”€ | é«˜ï¼ˆéœ€è¦è¿è¡Œå®Œæ•´ OSï¼‰                    | ä½ï¼ˆåªè¿è¡Œåº”ç”¨åŠä¾èµ–ï¼‰                          |
| å¯åŠ¨é€Ÿåº¦ | æ…¢ï¼ˆåˆ†é’Ÿçº§ï¼‰                          | å¿«ï¼ˆç§’çº§ï¼‰                                |


> **è™šæ‹ŸåŒ–æ˜¯â€œè·‘å¤šä¸ªç³»ç»Ÿâ€**ï¼Œ  
> **å®¹å™¨åŒ–æ˜¯â€œè·‘å¤šä¸ªåº”ç”¨â€**ã€‚

ç»“æ„ä¸Šï¼š

| é¡¹ç›®   | è™šæ‹Ÿæœºï¼ˆVMï¼‰                              | å®¹å™¨ï¼ˆDockerï¼‰                        |
| ---- | ------------------------------------ | --------------------------------- |
| è¿è¡Œåœ¨  | **Hypervisor ä¸Š**ï¼ˆæ¯”å¦‚ KVMã€VMwareï¼‰      | **å®¿ä¸»æœº OS ä¸Š**                      |
| å†…æ ¸   | **æ¯ä¸ª VM æœ‰è‡ªå·±å†…æ ¸**                      | **æ‰€æœ‰å®¹å™¨å…±äº«å®¿ä¸»æœºå†…æ ¸**                   |
| éš”ç¦»æ–¹å¼ | é€šè¿‡ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼ˆCPU æŒ‡ä»¤å±‚ï¼‰                     | é€šè¿‡å†…æ ¸ç‰¹æ€§ï¼ˆnamespaceã€cgroupsï¼‰         |
| å¯åŠ¨å•ä½ | æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼ˆGuest OSï¼‰                     | å•ä¸ªåº”ç”¨æˆ–è¿›ç¨‹ç¯å¢ƒ                         |
| å…¸å‹ç»“æ„ | ==OS â†’ Hypervisor â†’ Guest OS â†’ App== | ==OS â†’ Docker â†’ Container â†’ App== |
dockerç»„ä»¶çš„å…³ç³»ï¼š
**çº¯ç²¹çš„dockerï¼š**
+---------------------------------------------------+
|                 Docker CLI (å®¢æˆ·ç«¯)               |
|        docker run / docker ps / docker pull       |
+-------------------------|-------------------------+
                          â†“ REST API (Unix Socket / TCP)
+---------------------------------------------------+
|               ==Docker Daemon (dockerd)==             |
|   ç®¡ç†é•œåƒã€ç½‘ç»œã€å·ã€å®¹å™¨ï¼›è°ƒç”¨ containerd       |
+-------------------------|-------------------------+
                          â†“ gRPC
+---------------------------------------------------+
|                   ==containerd==                      |
|     è´Ÿè´£å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè°ƒç”¨ runc åˆ›å»ºå®¹å™¨       |
+-------------------------|-------------------------+
                          â†“ OCI æ ‡å‡†æ¥å£
+---------------------------------------------------+
|                      ==runc==                         |
|     ç›´æ¥è°ƒç”¨ Linux å†…æ ¸ï¼ˆnamespace/cgroupsï¼‰å®ç°éš”ç¦» |
+-------------------------|-------------------------+
                          â†“
+---------------------------------------------------+
|                Linux å†…æ ¸ï¼ˆNamespace+Cgroupsï¼‰     |
|        æä¾›è¿›ç¨‹éš”ç¦»ã€èµ„æºé™åˆ¶ã€ç½‘ç»œè™šæ‹ŸåŒ–ç­‰åŠŸèƒ½     |
+---------------------------------------------------+

k8sï¼š
docker-shim
æœ€åˆï¼ˆK8s æ—©æœŸç‰ˆæœ¬ï¼‰ï¼ŒKubernetes é»˜è®¤ä½¿ç”¨ **Docker** æ¥è¿è¡Œå®¹å™¨ã€‚  
ä½† ==Kubernetes æœ¬èº«å¹¶ä¸ç›´æ¥ç†è§£ Dockerï¼Œå®ƒåªè®¤è¯†ä¸€ä¸ªæ¥å£æ ‡å‡†==ï¼š

> **CRIï¼ˆContainer Runtime Interfaceï¼‰â€”â€” å®¹å™¨è¿è¡Œæ—¶æ¥å£**

`dockershim` æ˜¯ Kubernetes ä¸­çš„ä¸€ä¸ª **é€‚é…å±‚ï¼ˆShim Layerï¼‰**ï¼Œ  
ç”¨æ¥è®© Kubernetes èƒ½é€šè¿‡ CRI æ¥å£è°ƒç”¨ Dockerã€‚

Kubernetes
 â”œâ”€â”€ kubelet
 â”‚    â””â”€â”€ CRI æ¥å£
 â”‚         â””â”€â”€ dockershimï¼ˆç¿»è¯‘å±‚ï¼‰
 â”‚              â””â”€â”€ Docker Engine (dockerd)
 â”‚                   â””â”€â”€ containerd
 â”‚                        â””â”€â”€ runc


Kubernetes ç¤¾åŒºåæ¥å‘ç°ï¼š

- Docker æœ¬èº«ä¾èµ– `containerd`ï¼›
- è€Œ `containerd` **æœ¬èº«å·²ç»æ˜¯ CRI å…¼å®¹çš„è¿è¡Œæ—¶**ï¼›
- æ‰€ä»¥ kubelet â†’ containerd å°±å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œ  
    **ä¸å†éœ€è¦ Docker + dockershim è¿™ä¸¤å±‚ä¸­é—´ä»¶**ã€‚
    

ğŸ§¨ ç¼ºç‚¹ï¼š

- dockershim å¢åŠ äº†ä¸­é—´å±‚ï¼ˆæ€§èƒ½å¼€é”€ï¼‰ï¼›
    
- ç»´æŠ¤æˆæœ¬é«˜ï¼›
    
- ä¸ Kubernetes å‘å±•æ–¹å‘ï¼ˆç»Ÿä¸€ CRIï¼‰ä¸ä¸€è‡´ã€‚
    

ğŸ‘‰ å› æ­¤ä» **Kubernetes 1.24 å¼€å§‹**ï¼Œå®˜æ–¹å½»åº•ç§»é™¤äº† `dockershim`ã€‚


 æ¶æ„å¯¹æ¯”å›¾

 1ï¸âƒ£ æ—§æ¶æ„ï¼ˆK8s 1.23 åŠä¹‹å‰ï¼‰ï¼š
![[Pasted image 20251020105147.png]]

 2ï¸âƒ£ æ–°æ¶æ„ï¼ˆK8s 1.24+ï¼‰ï¼š

![[Pasted image 20251020105157.png]]

é‚£æ–°æ¶æ„æ˜¯ä¸æ˜¯æ²¡æœ‰å¼•æ“äº†å‘¢ï¼Ÿ

â€œåæ¥æ²¡æœ‰äº† Docker Engine è¿™ä¸ªç‹¬ç«‹ç»„ä»¶ï¼Œä½† c**ontainerd è‡ªèº«å·²ç»å…·å¤‡å¼•æ“åŠŸèƒ½ï¼Œ**  
å–ä»£äº†åŸæœ¬ Docker Engine + dockershim çš„ç»„åˆã€‚â€


æœªæ¥ï¼ˆå…¶å®ç°åœ¨å·²ç»æ˜¯ä¸»æµè¶‹åŠ¿ï¼‰ç¡®å®æ˜¯ **ç¬¬äºŒç§æ¶æ„æ–¹å‘ï¼šå»æ‰ Docker Engineï¼Œåªä¿ç•™ containerd æˆ– CRI-O**ã€‚

==Docker è¿˜â€œæ­»â€äº†å—ï¼Ÿ==

æ²¡æ­»ï¼Œåªæ˜¯ï¼š

- åœ¨ **å¼€å‘ç¯å¢ƒ** ä»ç„¶æœ€æ–¹ä¾¿ï¼ˆDocker CLIã€Composeã€Desktop éƒ½å¾ˆå¥½ç”¨ï¼‰ï¼›
    
- ä½†åœ¨ **ç”Ÿäº§ç¯å¢ƒ / K8s é›†ç¾¤** é‡Œï¼Œä¸å†éœ€è¦å®ƒï¼›
    
- Docker æ„å»ºå‡ºçš„é•œåƒä¾ç„¶é€šç”¨ï¼Œcontainerdã€CRI-O éƒ½å¯ä»¥è¿è¡Œå®ƒã€‚

![[Pasted image 20251020114454.png]]

|ç¯èŠ‚|ä¸»æµå·¥å…·|æ˜¯å¦ç¦»å¼€ Docker|
|---|---|---|
|é•œåƒæ„å»º|âœ… Dockerï¼ˆæˆ– BuildKitã€Podmanï¼‰|å¦|
|é•œåƒåˆ†å‘|âœ… Docker Registry / Harbor|å¦|
|å®¹å™¨è¿è¡Œ|âœ… Kubernetes + containerd / CRI-O|æ˜¯|
|å¼€å‘è°ƒè¯•|âœ… Docker CLI / Docker Compose|å¦|

> ğŸŸ¢ â€œDocker è¿˜åœ¨é€ é•œåƒï¼Œåªæ˜¯ä¸å†è·‘å®¹å™¨ã€‚â€

æ€»ç»“ï¼š
å¼€å‘é•œåƒdockeræ˜¯ä¸»æµï¼Œè¿è¡Œå®¹å™¨k8sæ˜¯ä¸»æµï¼Œä¸¤ä¸ªæ˜¯åˆä½œå…³ç³»å¹¶ä¸ä¼šæŠŠdockerè¸¢æ‰

==å¯¹è±¡èµ„æºæœ‰å“ªäº›==ï¼Ÿ

k8s çš„èµ„æºå¯ä»¥åˆ†ä¸º **å·¥ä½œè´Ÿè½½ï¼ˆWorkloadï¼‰ã€é…ç½®ï¼ˆConfigï¼‰ã€å­˜å‚¨ï¼ˆStorageï¼‰ã€è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ã€ç½‘ç»œï¼ˆNetworkï¼‰** ç­‰å‡ ä¸ªå¤§ç±»ã€‚

æˆ‘å¸®ä½ æ•´ç†æˆä¸€å¼ æ¸…æ™°çš„è¡¨æ ¼å’Œé€»è¾‘åˆ†ç±»ï¼š

---

ğŸ§© ä¸€ã€å·¥ä½œè´Ÿè½½èµ„æºï¼ˆWorkloadsï¼‰

ç”¨äº **è¿è¡Œåº”ç”¨ç¨‹åºå’Œç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ**

|èµ„æºå¯¹è±¡|ä½œç”¨|ç‰¹ç‚¹|
|---|---|---|
|**Pod**|Kubernetes æœ€å°è°ƒåº¦å•å…ƒ|å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç´§å¯†è€¦åˆçš„å®¹å™¨|
|**ReplicaSet**|ç¡®ä¿ Pod å‰¯æœ¬æ•°|ç”¨äºä¿è¯æŸä¸ª Pod çš„å‰¯æœ¬æ•°é‡ï¼Œè‡ªåŠ¨åˆ›å»º/åˆ é™¤ Pod|
|**Deployment**|ç®¡ç† ReplicaSet|æ”¯æŒæ»šåŠ¨å‡çº§ã€å›æ»šã€ç‰ˆæœ¬ç®¡ç†|
|**StatefulSet**|æœ‰çŠ¶æ€æœåŠ¡|Pod æœ‰å›ºå®šæ ‡è¯†ï¼Œç¨³å®šå­˜å‚¨ã€é¡ºåºå¯åŠ¨ã€ç½‘ç»œèº«ä»½|
|**DaemonSet**|æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ª Pod|å¸¸ç”¨äºèŠ‚ç‚¹å®ˆæŠ¤è¿›ç¨‹ï¼ˆæ—¥å¿—æ”¶é›†ã€ç›‘æ§ï¼‰|
|**Job**|ä¸€æ¬¡æ€§ä»»åŠ¡|Pod å®Œæˆåé€€å‡ºï¼Œä¿è¯æ‰§è¡Œä¸€æ¬¡æˆ– N æ¬¡|
|**CronJob**|å®šæ—¶ä»»åŠ¡|ç±»ä¼¼ Linux cronï¼ŒæŒ‰æ—¶é—´å‘¨æœŸæ‰§è¡Œ Job|

---

 ğŸ§© äºŒã€æœåŠ¡ä¸ç½‘ç»œï¼ˆNetworking & Serviceï¼‰

ç”¨äº **Pod é—´é€šä¿¡ã€æœåŠ¡æš´éœ²ã€è´Ÿè½½å‡è¡¡**

|èµ„æºå¯¹è±¡|ä½œç”¨|ç‰¹ç‚¹|
|---|---|---|
|**Service**|æœåŠ¡æŠ½è±¡|ClusterIPã€NodePortã€LoadBalancerã€ExternalName ç­‰ç±»å‹|
|**Ingress**|HTTP/HTTPS è·¯ç”±|æä¾›å¤–éƒ¨è®¿é—®å…¥å£ï¼Œæ”¯æŒè·¯å¾„/åŸŸåè½¬å‘|
|**NetworkPolicy**|ç½‘ç»œè®¿é—®æ§åˆ¶|æ§åˆ¶ Pod é—´ã€Pod ä¸å¤–éƒ¨æµé‡çš„è®¿é—®ç­–ç•¥|

---

ğŸ§© ä¸‰ã€é…ç½®ä¸ç®¡ç†ï¼ˆConfig & Policyï¼‰

ç”¨äº **é…ç½®ã€ç§˜é’¥ã€ç­–ç•¥ç®¡ç†**

|èµ„æºå¯¹è±¡|ä½œç”¨|
|---|---|
|**ConfigMap**|å­˜å‚¨é…ç½®ä¿¡æ¯ï¼ˆæ–‡æœ¬ã€ç¯å¢ƒå˜é‡ï¼‰|
|**Secret**|å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€tokenã€è¯ä¹¦ï¼‰|
|**Namespace**|å‘½åç©ºé—´|
|**ResourceQuota**|é™åˆ¶èµ„æºä½¿ç”¨|
|**LimitRange**|Pod/Container èµ„æºé™åˆ¶|

---

 ğŸ§© å››ã€å­˜å‚¨ï¼ˆStorageï¼‰

ç”¨äº **æ•°æ®æŒä¹…åŒ–å’Œå·ç®¡ç†**

|èµ„æºå¯¹è±¡|ä½œç”¨|
|---|---|
|**PersistentVolume (PV)**|ç‰©ç†å­˜å‚¨å·|
|**PersistentVolumeClaim (PVC)**|ç”¨æˆ·è¯·æ±‚å·|
|**StorageClass**|åŠ¨æ€å­˜å‚¨ç­–ç•¥|
|**Volume**|Pod å†…éƒ¨æŒ‚è½½å·|

---

 ğŸ§© äº”ã€è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

ç”¨äº **ç”¨æˆ·ã€æœåŠ¡è´¦å·ã€æƒé™ç®¡ç†**

|èµ„æºå¯¹è±¡|ä½œç”¨|
|---|---|
|**ServiceAccount**|Pod ç»‘å®šèº«ä»½|
|**Role / ClusterRole**|å®šä¹‰æƒé™|
|**RoleBinding / ClusterRoleBinding**|æƒé™ç»‘å®š|

---

 ğŸ§© å…­ã€é›†ç¾¤ç®¡ç†ï¼ˆClusterï¼‰

ç”¨äº **ç®¡ç†é›†ç¾¤çŠ¶æ€ä¸èŠ‚ç‚¹**

|èµ„æºå¯¹è±¡|ä½œç”¨|
|---|---|
|**Node**|èŠ‚ç‚¹å¯¹è±¡|
|**PodDisruptionBudget**|Pod å¯ä¸­æ–­ç­–ç•¥|
|**CustomResourceDefinition (CRD)**|è‡ªå®šä¹‰èµ„æº|

---

 ğŸ”„ ä¸ƒã€èµ„æºå±‚çº§å…³ç³»

`Namespace  â”œâ”€ Workload (Pod/Deployment/StatefulSet/DaemonSet/Job/CronJob)  â”œâ”€ Config & Secrets (ConfigMap, Secret)  â”œâ”€ Networking (Service, Ingress, NetworkPolicy)  â”œâ”€ Storage (PVC, PV, StorageClass, Volume)  â””â”€ RBAC & Cluster (Role, ClusterRole, Node)`

---

ğŸ’¡ **è®°å¿†å°æŠ€å·§**ï¼š

- **Pod/Deployment** â†’ è¿è¡Œåº”ç”¨
    
- **Service/Ingress** â†’ æš´éœ²åº”ç”¨
    
- **ConfigMap/Secret** â†’ é…ç½®å’Œæ•æ„Ÿä¿¡æ¯
    
- **PVC/PV/StorageClass** â†’ æŒä¹…åŒ–å­˜å‚¨
    
- **RBAC** â†’ æ§åˆ¶è°èƒ½å¹²ä»€ä¹ˆ

# å›é¡¾

### linuxå¸¸ç”¨å‘½ä»¤
```
æ–‡ä»¶ä¸ç›®å½•æ“ä½œ:lsã€cdã€pwdã€mkdirã€touchã€cpã€mvã€rmã€catã€more / lessã€headã€tailã€findã€grepã€wcã€sedã€awk
ç³»ç»Ÿä¸è¿›ç¨‹ç®¡ç†ï¼špsã€topã€killã€freeã€dfã€systemctl
æŸ¥çœ‹å†…å­˜ã€cpuã€ç£ç›˜ä½¿ç”¨ï¼šfree -hã€topã€df -h
ç½‘ç»œç®¡ç†ï¼šip aã€pingã€curlã€wgetã€scpã€ssh
ç”¨æˆ·æƒé™ï¼šuseraddã€passwdã€userdelã€groupaddã€chmodã€chmod
æ‰“åŒ…å‹ç¼©ï¼štarã€unzip\zip
æ—¶é—´ä¸è®¡åˆ’:dateã€crontab
è½¯ä»¶åŒ…ç®¡ç†ï¼šyumã€rpm
æ—¥å¿—ç›‘æ§ï¼štail -fï¼ˆå®æ—¶æŸ¥çœ‹ï¼‰



```

### DNS

	1.ç«¯å£åè®®53

	2.é€’å½’ã€è¿­ä»£

	3.dnsè¯·æ±‚æµç¨‹

### DHCP

	1. åè®®ç«¯å£6768,å¹²ä»€ä¹ˆç”¨çš„

### Rsync

	1.é€‰é¡¹

-a //é€’å½’å¤åˆ¶ç›®å½• + ä¿ç•™æƒé™ -v //å¯è§†åŒ– -z //å‹ç¼©

	2.Client/Serverï¼ˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰æ¨¡å¼æ­å»ºï¼š
	
![[Pasted image 20251027170910.png]]
		
 ### mysqlä¸»ä»å¤åˆ¶

	1.ä¸»ä»å¤åˆ¶åŸç†

	2.ä¸»ä»å¤åˆ¶æˆåŠŸåˆ¤æ–­ï¼š

![image-20251014133945378](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014133945378.png?lastModify=1760942787)

### SQLè¯­å¥

	1.é—®ä¸€ä¸ªå®é™…è¯­å¥
```
SQLï¼ˆStructured Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰

DDL (Data Definition Language)
DQL (Data Query Language)  æœ‰äº›ä¹¦å•ç‹¬åˆ—ä¸º DQL
DML (Data Manipulation Language)
DCL (Data Control Language)æ•°æ®æƒé™æ§åˆ¶
TCL (Transaction Control Language)


INSERT INTO table_name (name, age) VALUES 
UPDATE table_name SET 
DELETE FROM table_name WHERE
SELECT * FROM table_name;

GRANT æƒé™ ON è¡¨ TO ç”¨æˆ· IDENTIFIED BY å¯†ç 
REVOKE æƒé™ ON è¡¨ FROM ç”¨æˆ·
```
### mysqlå¤‡ä»½æ¢å¤

	1.mysqldumpå‘½ä»¤æ ¼å¼

![image-20251014134322999](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014134322999.png?lastModify=1760942787)

### grepã€sedã€awk
```
	1.é—®ä¸€ä¸ªå®é™…è¯­å¥
	grep [é€‰é¡¹] 'æ¨¡å¼' [æ–‡ä»¶...] ä¸»è¦æ˜¯è¿‡æ»¤æ–‡ä»¶
	
	sed [é€‰é¡¹] 'è„šæœ¬å‘½ä»¤' [è¾“å…¥æ–‡ä»¶æˆ–ç®¡é“è¾“å…¥]ï¼Œå°±æ˜¯ç¼–è¾‘ï¼ˆæ‰“å°ã€åˆ é™¤ã€æ›¿æ¢ã€æ’å…¥ï¼‰
	 è„šæœ¬å‘½ä»¤=è¡ŒèŒƒå›´/æ¨¡å¼èŒƒå›´+æ“ä½œ
	 
	 -n+p
	 
	 awkå¤„ç†ç»“æ„åŒ–æ–‡æœ¬ï¼ˆå¦‚è¡¨æ ¼ã€æ—¥å¿—ï¼‰
	 awk -é€‰é¡¹ 'æ¨¡å¼ {åŠ¨ä½œ}' æ–‡ä»¶
	 'æ­£åˆ™è¡¨è¾¾å¼/æ¡ä»¶è¡¨è¾¾å¼{æ‰“å°ï¼Œç®—æœ¯è¿ç®—ï¼Œä¿®æ”¹ï¼Œ}'
	 &&ç»„åˆæ¨¡å¼
	 -Få­—ç¬¦

find /path/to/dir -type f -mtime +30 -exec rm -f {} \;

```
### shellè„šæœ¬
	1.é¢„å®šä¹‰å˜é‡/è„šæœ¬å‚æ•°

![image-20251014134609730](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014134609730.png?lastModify=1760942787)
```
"è„šæœ¬å: $0"
### æœªåŠ å¼•å·æ—¶

æœªåŠ å¼•å·`$*  å’Œ  $@  å®Œå…¨ä¸€æ ·`
åŠ å¼•å·æ—¶+forå¾ªç¯ï¼Œ$*ä½œä¸ºæ•´ä½“å­—ç¬¦ä¸²ï¼›
         $@ä½œä¸ºå•ä¸ª
  
if [ ];
then 
else   
fi   

if [ æ¡ä»¶1 ]; 
then
elif [ æ¡ä»¶2 ];
then
else
fi 

for in
do
done

while [  ]
do

done  
(( )) æ˜¯ç®—æœ¯è¡¨è¾¾å¼
[ æ¡ä»¶è¡¨è¾¾å¼ ]testå‘½ä»¤
ï¼ˆæ³¨æ„ï¼šå·¦å³ä¸¤è¾¹éƒ½è¦æœ‰ç©ºæ ¼ï¼ï¼‰

```
	2.æ§åˆ¶è¯­å¥å‡ºä¸ªé¢˜

---ç½‘ç«™æ¶æ„
### webåŸºç¡€

	1.httpæ–¹æ³•

getè¯·æ±‚èµ„æº  
headè·å–å“åº”å¤´  
postæäº¤æ•°æ®ï¼Œåˆ›å»ºèµ„æº  
putæäº¤æ•°æ®ï¼Œå®Œå…¨æ›´æ–°èµ„æº  
patchæäº¤æ•°æ®ï¼Œéƒ¨åˆ†æ›´æ–°èµ„æº  
deleteåˆ é™¤èµ„æº  
connectå»ºç«‹éš§é“  
optionsæŸ¥è¯¢æœåŠ¡å™¨æ”¯æŒçš„HTTPæ–¹æ³•  
traceå›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚

	2.çŠ¶æ€ç 

1 ä¿¡æ¯å“åº” è¯·æ±‚å·²æ¥æ”¶ï¼Œ**ç»§ç»­å¤„ç†** 
2 æˆåŠŸå“åº” è¯·æ±‚å·²æˆåŠŸè¢«æ¥æ”¶**å¹¶å¤„ç†** 
3 é‡å®šå‘å“åº” éœ€è¦è¿›ä¸€æ­¥æ“ä½œä»¥å®Œæˆè¯·æ±‚
4 å®¢æˆ·ç«¯é”™è¯¯ è¯·æ±‚æœ‰é—®é¢˜ï¼ˆè¯­æ³•ã€æƒé™ã€èµ„æºä¸å­˜åœ¨ï¼‰
5 æœåŠ¡å™¨é”™è¯¯ æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶å‡ºé”™

### nignx

	1.å¹¶å‘æ¨¡å‹

```
select  
poll  
epoll  
kqueue  
/dev/poll
Linux ç¯å¢ƒä¸‹ Nginx é»˜è®¤ä½¿ç”¨ `epoll`ï¼Œå¯æ”¯æŒæˆåƒä¸Šä¸‡çš„å¹¶å‘è¿æ¥ï¼Œæ˜¯é«˜æ€§èƒ½çš„å…³é”®ã€‚
```
	2.å·¥ä½œåŸç†

masterè¿›ç¨‹ workè¿›ç¨‹--å¤šä¸ªè¿æ¥
	
	3.ç‰ˆæœ¬1.28.0

	4.ç«¯å£80

	5.ç¼–è¯‘æ¨¡å—

![image-20251014135513765](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014135513765.png?lastModify=1760942787)

	6.ä¼˜åŒ–é¡¹
```
æ€§èƒ½ä¼˜åŒ–:
é¡µé¢ç¼“å­˜
è¿æ¥è¶…æ—¶keepalive_timeout` 
æ—¥å¿—åˆ‡å‰²
workè¿›ç¨‹æ•°worker_processes auto;
workå¤„ç†è¿æ¥æ•°ï¼šworker_connections 10240;
æŒ‡å®šäº‹ä»¶æ¨¡å‹ï¼šuse epoll;
cpuäº²å’Œæ€§work_cpu_affinity 
é¡µé¢å‹ç¼©gzip on
```



	7.å¹³æ»‘å‡çº§å„ä¿¡å·
```
æ›¿æ¢äºŒè¿›åˆ¶nginx
å‘user2ä¿¡å·   #å¼€å¯æ–°çš„masteråŠå…¶work
å‘é€winchä¿¡å·    #å…³é—­æ—§work
å‘é€quitä¿¡å·      #å…³é—­æ—§master
```
	8.locationå‰ç¼€å«ä¹‰ã€ä¼˜å…ˆçº§
```
ç²¾ç¡®åŒ¹é…
å‰ç¼€åŒ¹é…ï¼ˆå¸¦ ^~ï¼‰
æ­£åˆ™åŒ¹é… ~ / ~*
é€šå‰ç¼€åŒ¹é… /img/ ç­‰
```
### LNMP

	1.å­—æ¯å«ä¹‰

	2.fastcgiæ˜¯ä»€ä¹ˆ
```
Web æœåŠ¡å™¨ä¸ PHP å¼•æ“ä¹‹é—´çš„é€šä¿¡åè®®

php-fpmFastCGI çš„ PHP å®ç°ï¼Œç›‘å¬ç«¯å£ 9000

æµè§ˆå™¨ â†’ Nginx â†’ FastCGI (php-fpm:FastCGI è¿›ç¨‹) â†’ PHPè„šæœ¬(FastCGI è´Ÿè´£è°ƒç”¨ PHP è§£é‡Šå™¨æ‰§è¡Œè„šæœ¬) â†’ MySQLæŸ¥è¯¢ â†’ è¿”å›ç»“æœ
```
	3.php9000
```
`php-fpm`ï¼ˆPHP FastCGI Process Managerï¼‰é»˜è®¤ç›‘å¬çš„ç«¯å£æ˜¯ 9000ã€‚

location ~ \.php$ {
    fastcgi_pass 127.0.0.1:9000;
}
```

### tomcat
	é…ç½®æ–‡ä»¶
```
conf/server.xml:ç«¯å£ã€æœåŠ¡ã€è¿æ¥å™¨ã€è™šæ‹Ÿä¸»æœºç­‰å…¨å±€è®¾ç½®
conf/web.xml:å…¨å±€ Web åº”ç”¨é»˜è®¤é…ç½®ï¼ˆæ‰€æœ‰åº”ç”¨å…±äº«ï¼‰
å®šä¹‰ Web åº”ç”¨é»˜è®¤çš„ Servlet è¡Œä¸º: 404 é”™è¯¯é¡µé¢ã€é»˜è®¤ MIME ç±»å‹æ˜ å°„ã€é»˜è®¤çš„ Servlet æ˜ å°„ æ¬¢è¿é¡µï¼ˆwelcome fileï¼‰
```
	ç«¯å£ã€ç‰ˆæœ¬
```
HTTP æœåŠ¡ç«¯å£ 8080
HTTPS ç«¯å£     443

|9.x|     |JDK 8/11|
```

	ä¼˜åŒ–é¡¹jvm
```
æ€§èƒ½ä¸»è¦å—JVMå‚æ•°å’Œè¿æ¥çº¿ç¨‹æ•°å½±å“
setenv.sh æˆ– catalina.shä¸­é…ç½®jvmå‚æ•°
server.xmlï¼š
è¿æ¥çº¿ç¨‹æ•°ï¼šConnector çš„maxThreads
```
### nginxè´Ÿè½½å‡è¡¡

	åå‘ä»£ç†ï¼šupstreamä¸»æœºç»„ã€proxy_pass http://ä¸»æœºç»„å
```
upstream
å®šä¹‰ä¸€ä¸ªåç«¯æœåŠ¡å™¨ç»„
- `server 192.168.1.xxx` â†’ åç«¯çœŸå®æœåŠ¡å™¨
- `proxy_pass http://backend;` â†’ å°†è¯·æ±‚è½¬å‘ç»™åç«¯ç»„
```

	  è°ƒåº¦ç®—æ³•
```
è½®è¯¢ï¼ˆé»˜è®¤ Round Robinï¼‰
æƒé‡è½®è¯¢ï¼ˆWeightï¼‰
IP Hash:ä¿è¯åŒä¸€ä¸ªå®¢æˆ·ç«¯æ€»æ˜¯è®¿é—®åŒä¸€å°æœåŠ¡å™¨
Least Connectionsï¼ˆæœ€å°‘è¿æ¥ï¼‰è¯·æ±‚å‘é€ç»™å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨

â€œNginx çš„è´Ÿè½½å‡è¡¡é€šè¿‡ `upstream` å®šä¹‰åç«¯ä¸»æœºç»„ï¼Œç„¶åé€šè¿‡ `proxy_pass` è½¬å‘è¯·æ±‚ã€‚å®ƒæ”¯æŒå¤šç§è°ƒåº¦ç®—æ³•ï¼Œæ¯”å¦‚è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ã€åŠ æƒè½®è¯¢ã€IP å“ˆå¸Œå’Œæœ€å°‘è¿æ¥ã€‚è¿˜å¯ä»¥é…åˆ `max_fails`/`fail_timeout` å®ç°åç«¯å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»ã€‚â€

fail_timeoutå†…å¤±è´¥maxfailsæ¬¡ï¼Œåœæ­¢fail_timeoutç§’åå†å°è¯•è¿æ¥ï¼Œåœæ­¢çš„fail_timeoutæ—¶é—´å†…è®¤ä¸ºä¸å¯ç”¨
```

-------------é›†ç¾¤

### lvs
```
Linux å†…æ ¸å±‚çš„è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆ;
é€šè¿‡ å†…æ ¸æ¨¡å—ip_vs å®ç°è´Ÿè½½å‡è¡¡åŠŸèƒ½;
- é«˜æ€§èƒ½ã€æ”¯æŒå¤§å¹¶å‘ã€å¯å¤„ç†å››å±‚ï¼ˆTCP/UDPï¼‰è´Ÿè½½å‡è¡¡ã€‚
- LVS å·¥ä½œåœ¨ **ç¬¬ 4 å±‚ï¼ˆä¼ è¾“å±‚ï¼‰.å¤„ç†çš„æ˜¯ IP å’Œç«¯å£ï¼Œä¸æ¶‰åŠ HTTP å†…å®¹ï¼ˆç¬¬ 7 å±‚ï¼‰
  
Directorï¼ˆè°ƒåº¦å™¨ï¼‰
LVS çš„å‰ç«¯æœåŠ¡å™¨ï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶è°ƒåº¦åˆ°åç«¯çœŸå®æœåŠ¡å™¨ï¼ˆReal Server, RSï¼‰ã€‚
ä¹Ÿå« LVS-DR æœºå™¨ æˆ– è´Ÿè½½å‡è¡¡å™¨ã€‚

Real Serverï¼ˆRSï¼‰
çœŸæ­£æä¾›æœåŠ¡çš„åç«¯æœåŠ¡å™¨ã€‚
å¯ç”¨ä»»ä½•æ“ä½œç³»ç»Ÿå’Œ Web æœåŠ¡ï¼ˆå¦‚ Nginx/Tomcatï¼‰

ip_vs å†…æ ¸æ¨¡å—
LVS çš„æ ¸å¿ƒå®ç°ï¼Œå¤„ç†åŒ…çš„è½¬å‘ã€è°ƒåº¦ç®—æ³•ã€è¿æ¥è¿½è¸ªã€‚

```
	å†…æ ¸æ¨¡å—ip_vs

	å·¥ä½œæ¨¡å¼ã€åŸç†drï¼ˆ ceï¼‰
```
NATï¼ˆNetwork Address Translationï¼Œåœ°å€è½¬æ¢ï¼‰
æˆ·ç«¯ â†’ Director(NAT) â†’ RS â†’ Director â†’ å®¢æˆ·ç«¯

DRï¼ˆDirect Routingï¼Œç›´æ¥è·¯ç”±ï¼‰:åªä¿®æ”¹ç›®æ ‡ MAC åœ°å€ï¼Œå°†è¯·æ±‚ç›´æ¥å‘é€åˆ°åç«¯æœåŠ¡å™¨
å®¢æˆ·ç«¯ â†’ Director(DR) â†’ RS â†’ å®¢æˆ·ç«¯
ç«¯æœåŠ¡å™¨éœ€è¦é…ç½®è™šæ‹Ÿ IPï¼ˆVIPï¼‰åœ¨æœ¬åœ°ï¼Œå¹¶ä¸”ä¸èƒ½ ARP è¯¥ VIP

TUNï¼ˆIP Tunnelingï¼ŒIP éš§é“ï¼‰
åŸç†ï¼šDirector å°†è¯·æ±‚é€šè¿‡éš§é“å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ç›´æ¥å“åº”å®¢æˆ·## è°ƒåº¦ç®—æ³•

è°ƒåº¦ç®—æ³•
è½®è¯¢ï¼ˆRound Robinï¼‰ï¼šä¾æ¬¡åˆ†å‘è¯·æ±‚
åŠ æƒè½®è¯¢ï¼ˆWRRï¼‰ï¼šæ ¹æ®æœåŠ¡å™¨æƒé‡åˆ†é…è¯·æ±‚
æœ€å°‘è¿æ¥ï¼ˆLCï¼‰ï¼šè¯·æ±‚å‘ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨


LVS æ˜¯åŸºäº Linux å†…æ ¸æ¨¡å— ip_vs å®ç°çš„å››å±‚è´Ÿè½½å‡è¡¡ã€‚æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ Directorï¼ˆè°ƒåº¦å™¨ï¼‰å’Œåç«¯çœŸå®æœåŠ¡å™¨ã€‚LVS æ”¯æŒä¸‰ç§ä¸»è¦å·¥ä½œæ¨¡å¼ï¼šNATã€DRï¼ˆDirect Routingï¼‰ã€TUNï¼ˆIP éš§é“ï¼‰ã€‚
NATï¼šè¯·æ±‚å’Œå“åº”éƒ½ç»è¿‡ Directorï¼Œç®€å•ä½† Director æˆä¸ºç“¶é¢ˆã€‚
DRï¼šDirector åªä¿®æ”¹ MAC åœ°å€ï¼Œå“åº”ç›´æ¥è¿”å›å®¢æˆ·ç«¯ï¼Œæ€§èƒ½é«˜ã€‚
TUNï¼šè¯·æ±‚é€šè¿‡éš§é“å‘é€ï¼Œé€‚åˆè·¨ç½‘ç»œéƒ¨ç½²ã€‚
è°ƒåº¦ç®—æ³•æœ‰è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥ç­‰ï¼Œæ ¹æ®åç«¯è´Ÿè½½æƒ…å†µé€‰æ‹©ã€‚



```

### keepalived
```
ä¸»è¦ç”¨äº é«˜å¯ç”¨ï¼ˆHAï¼‰ï¼Œé€šå¸¸å’Œ LVS é…åˆï¼Œå®ç°è´Ÿè½½å‡è¡¡å™¨çš„å†—ä½™
```
	vrrp
```
VRRPï¼ˆVirtual Router Redundancy Protocolï¼‰ï¼šè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼Œç”¨äºå®ç° è™šæ‹Ÿ IPï¼ˆVIPï¼‰æ¼‚ç§»ã€‚

å¥åº·æ£€æŸ¥ï¼šå¯ä»¥æ£€æµ‹åç«¯æœåŠ¡å™¨æˆ–æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¹¶åŠ¨æ€è°ƒæ•´ VIPã€‚
```
	å·¥ä½œæ¨¡å¼ï¼šæŠ¢å ã€éæŠ¢å 
```
Keepalived ç”¨äºé«˜å¯ç”¨åœºæ™¯ï¼Œé€šè¿‡ VRRP åè®®å®ç° VIP æ¼‚ç§»ã€‚VRRP èŠ‚ç‚¹åˆ†ä¸º Master å’Œ Backupï¼Œé€šè¿‡å¿ƒè·³ç›‘æ§ Master çŠ¶æ€

æŠ¢å æ¨¡å¼ï¼ˆPreemptiveï¼‰ï¼šMaster æ¢å¤åä¼šä¸»åŠ¨æŠ¢å› VIPï¼Œä¼˜å…ˆçº§é«˜çš„èŠ‚ç‚¹æ€»æ˜¯æŒæœ‰ VIPã€‚
éæŠ¢å æ¨¡å¼ï¼ˆNon-preemptiveï¼‰ï¼šMaster æ¢å¤åä¸ä¼šæŠ¢å› VIPï¼Œä¿è¯ VIP ä¸åœ¨èŠ‚ç‚¹é—´é¢‘ç¹æ¼‚ç§»ã€‚â€
```
### haproxy
```
è½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼ˆå››å±‚ L4 / ä¸ƒå±‚ L7ï¼‰

```
	å¯¹æ¯”nignxã€lvsä½¿ç”¨æƒ…å†µ
```
LVS æ˜¯å†…æ ¸å±‚å››å±‚è´Ÿè½½å‡è¡¡ï¼Œæ€§èƒ½æé«˜ï¼Œé€‚åˆå¤„ç†å¤§å¹¶å‘ TCP/UDP è¯·æ±‚ï¼Œä½†æ— æ³•è¯†åˆ« HTTP å†…å®¹ï¼›
Nginx æ˜¯ç”¨æˆ·æ€å¼‚æ­¥äº‹ä»¶é©±åŠ¨ï¼Œæ”¯æŒ HTTP/HTTPS ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œé€‚åˆ Web æœåŠ¡å’Œç¼“å­˜ä»£ç†ï¼›
HAProxy æ”¯æŒ L4/L7 è´Ÿè½½å‡è¡¡ï¼Œå†…ç½®å¥åº·æ£€æŸ¥å’Œä¼šè¯ä¿æŒï¼Œé€‚åˆå¯¹é«˜å¯ç”¨å’Œä¸ƒå±‚è°ƒåº¦æœ‰è¦æ±‚çš„åœºæ™¯ã€‚åœ¨å®é™…æ¶æ„ä¸­ï¼Œå¸¸ç”¨ LVS åš L4 è½¬å‘ + HAProxy/Nginx åš L7 è°ƒåº¦ã€‚
```

------ç¼“å­˜

### redis

![image-20251014141254024](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014141254024.png?lastModify=1760942787)
```
å†…å­˜æ•°æ®åº“ï¼ˆIn-Memory Databaseï¼‰ï¼Œå¯æŒä¹…åŒ–åˆ°ç£ç›˜

```

![image-20251014141313425](file:///C:/Users/chen2/Desktop/%E5%AE%9E%E8%AE%AD%E7%AC%94%E8%AE%B0/%E4%BA%91%E8%AE%A1%E7%AE%97%E7%AC%94%E8%AE%B0/image-20251014141313425.png?lastModify=1760942787)

```
æŒä¹…åŒ–:Memcachedä¸æ”¯æŒæŒä¹…åŒ–ï¼šåªæœ‰é”®å€¼å¯¹æ•°æ®ç±»å‹ï¼›
```

æ•°æ®ç±»å‹
```
æŒ‡çš„æ˜¯valueçš„ç±»å‹ï¼š
Stringï¼ˆå­—ç¬¦ä¸²ï¼‰
Listï¼ˆåˆ—è¡¨ï¼‰
Hashï¼ˆå“ˆå¸Œï¼‰
Setï¼ˆé›†åˆï¼‰
Sorted Set
```

ç‰ˆæœ¬
```
Redis 5.x â†’ Streams + åŸºç¡€åŠŸèƒ½
Redis 6.x â†’ å¤šçº¿ç¨‹ I/O + ACL + å®‰å…¨å¢å¼º
Redis 7.x â†’ ä¸»åŠ¨è¿‡æœŸ + Cluster ä¼˜åŒ– + æ€§èƒ½æå‡
```

ç«¯å£

æŒä¹…åŒ–ï¼šrdbã€aof
```
RDBï¼ˆå¿«ç…§æŒä¹…åŒ–ï¼‰
åŸç†ï¼šåœ¨æŒ‡å®šæ—¶é—´é—´éš”ç”Ÿæˆæ•°æ®å¿«ç…§ï¼Œä¿å­˜åˆ°ç£ç›˜
AOFï¼ˆAppend Only Fileï¼‰
åŸç†ï¼šæ¯æ¡å†™å‘½ä»¤è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œæ¢å¤æ—¶é‡æ–°æ‰§è¡Œå‘½ä»¤
```

![image-20251014141443924](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014141443924.png?lastModify=1760942787)

![image-20251014141504804](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014141504804.png?lastModify=1760942787)
rdb:
![image-20251014141456254](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014141456254.png?lastModify=1760942787)

**cluster**
```
å“¨å…µæ¨¡å¼
é«˜å¯ç”¨ï¼ˆä¸»ä»åˆ‡æ¢ï¼‰
æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ç›¸åŒï¼ˆä¸»ä»å¤åˆ¶ï¼‰
ä¸€ä¸»å¤šä» + å“¨å…µï¼ˆâ‰¥3ï¼‰
æœ‰ä¸­å¿ƒ
```

![image-20251014141553712](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014141553712.png?lastModify=1760942787)ä¸€èˆ¬æ˜¯3ä¸»3ä»

**sentinel**1ä¸»2ä»3å“¨å…µ
```
é›†ç¾¤æ¨¡å¼
Sentinelï¼ˆå“¨å…µï¼‰ç”¨äº ç›‘æ§ä¸»ä»æ¶æ„ï¼Œå½“ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰æ•…éšœæ—¶ï¼Œè‡ªåŠ¨å®Œæˆæ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰

åˆ†å¸ƒå¼ + é«˜å¯ç”¨
æ•°æ®åˆ†ç‰‡ï¼ˆå„èŠ‚ç‚¹å­˜ä¸åŒæ•°æ®ï¼‰
å¤šä¸»å¤šä»ï¼ˆæ¯ä¸»å¯¹åº”ä»ï¼‰
å»ä¸­å¿ƒåŒ–



Redis Sentinel æ˜¯é«˜å¯ç”¨æ–¹æ¡ˆï¼Œç”¨äºä¸»ä»åˆ‡æ¢å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œä¿è¯æœåŠ¡ä¸ä¸­æ–­ï¼›è€Œ Redis Cluster æ˜¯åˆ†å¸ƒå¼æ–¹æ¡ˆï¼Œé€šè¿‡ 16384 ä¸ªæ§½ä½å®ç°è‡ªåŠ¨åˆ†ç‰‡å­˜å‚¨å’Œä¸»ä»å®¹é”™ï¼Œæ—¢èƒ½æ‰©å±•æ€§èƒ½ï¼Œåˆèƒ½ä¿è¯é«˜å¯ç”¨ã€‚ä¸€èˆ¬å°è§„æ¨¡é«˜å¯ç”¨é€‰ Sentinelï¼Œå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨é€‰ Cluster


ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰çš„æœ¬è´¨:å®ç°æ•°æ®å†—ä½™ï¼ˆå¤‡ä»½ï¼‰ä¸è¯»å†™åˆ†ç¦»
ä¸»ä»å¤åˆ¶ â‰  é«˜å¯ç”¨ï¼Œå®ƒåªæ˜¯â€œå†—ä½™å¤åˆ¶â€
å“¨å…µï¼ˆSentinelï¼‰çš„å‡ºç°â€”â€”è®©ä¸»ä»å…·å¤‡â€œè‡ªåŠ¨æ•…éšœæ¢å¤â€
ç›‘æ§ã€é€šçŸ¥ã€è‡ªåŠ¨æ•…éšœè½¬ç§»ã€é…ç½®æ›´æ–°

|é¡¹ç›®|ä¸»ä»å¤åˆ¶|å“¨å…µ / ç®¡ç†æœºåˆ¶|
|---|---|---|
|Redis|ä¸»ä»å¤åˆ¶ä»…æä¾›å†—ä½™|Sentinel æä¾›è‡ªåŠ¨æ•…éšœè½¬ç§»|
|MySQL|ä¸»ä»å¤åˆ¶ä»…æä¾›å†—ä½™|MHAã€Orchestratorã€Keepalived ç­‰è´Ÿè´£è‡ªåŠ¨åˆ‡æ¢|

æ‰€ä»¥æ— è®ºæ˜¯ **Redis** è¿˜æ˜¯ **MySQL**ï¼Œ

> â€œä¸»ä»å¤åˆ¶â€ åªæ˜¯ **æ•°æ®å†—ä½™æœºåˆ¶**ï¼Œ  
> â€œå“¨å…µ / ç®¡ç†ç»„ä»¶â€ æ‰æ˜¯ **é«˜å¯ç”¨æœºåˆ¶**ã€‚
```
### mongodb

ç«¯å£ï¼š27017

ç‰ˆæœ¬ï¼š6.0.4

å‰¯æœ¬é›†ã€~~åˆ‡ç‰‡~~
```
å‰¯æœ¬é›†ï¼ˆReplica Setï¼‰
é«˜å¯ç”¨ + æ•°æ®å†—ä½™
Primaryï¼ˆä¸»èŠ‚ç‚¹ï¼‰ï¼šå†™æ“ä½œ
Secondaryï¼ˆä»èŠ‚ç‚¹ï¼‰ï¼šåŒæ­¥ã€è¯»è¯·æ±‚
Arbiterï¼ˆä»²è£èŠ‚ç‚¹ï¼‰ï¼šå‚ä¸é€‰ä¸¾ï¼Œä¸ä¿å­˜æ•°æ®

æ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»å’Œä¸»ä»åŒæ­¥

å•ä¸ªå‰¯æœ¬é›†æ— æ³•æ‰¿è½½æµ·é‡æ•°æ®æˆ–é«˜å¹¶å‘è®¿é—®æ—¶ï¼Œé€šè¿‡åˆ†ç‰‡ï¼ˆShardingï¼‰å®ç° åˆ†å¸ƒå¼å­˜å‚¨

```

------------CICD

![image-20251014142047004](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014142047004.png?lastModify=1760942787)

ä¸Šçº¿javaã€phpç¨‹åº![image-20251014141954101](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014141954101.png?lastModify=1760942787)
```

git push <è¿œç¨‹ä»“åº“å> <æœ¬åœ°åˆ†æ”¯å>:<è¿œç¨‹åˆ†æ”¯å> [é€‰é¡¹]
å¯†é’¥äº’ä¿¡ï¼š
gitå¼€å‘->gitlab
jenkins->gitlab
jenkins->tomcat


ç ”å‘-gitlab-jenkins+shell-tomcat
jekninsä¸»æœºå®‰è£…mavenï¼Œæ›´æ¢ Maven ä»“åº“åœ°å€ï¼ˆä¸‹è½½ä¾èµ–çš„è¿œç¨‹ä»“åº“ URLï¼‰
jekinså‚æ•°ï¼š
å®‰è£…mavenæ’ä»¶
global tools configuration---jdkè·¯å¾„+mavenè·¯å¾„
åˆ›å»ºitemï¼šæ„å»ºmavené¡¹ç›®-gitlabä»“åº“åœ°å€-åˆ†æ”¯å-æ‰“åŒ…å‘½ä»¤-æ·»åŠ shellå‘½ä»¤ï¼ˆexecute shellï¼‰-åœæ­¢tomcatã€åˆ é™¤æ—§æ–‡ä»¶ç›®å½•ã€æ‹·è´æ‹‰å–æ„å»ºå¥½waråŒ…ç»™tomcatã€å¯åŠ¨tomcat-ä¿å­˜
ç‚¹å‡»æ„å»º

ç ”å‘-gitlab-jenkins+ansible-lnmp
jekinsä¸»æœºå®‰è£…absible
jekinså‚æ•°ï¼š
å®‰è£…ansibleæ’ä»¶ã€git parameter
global tools configuration---jdkè·¯å¾„+mavenè·¯å¾„
åˆ›å»ºitemï¼šæ„å»ºfreestyleé¡¹ç›®-thisprojectisparameterizedï¼ˆæ·»åŠ å‚æ•°-git patrameter-åç§°-æ ‡ç­¾ï¼‰-gitlabä»“åº“åœ°å€-åˆ†æ”¯åï¼ˆ$tagåç§°ï¼‰-æ·»åŠ æ„å»ºæ­¥éª¤ï¼ˆansiblecommand-ä¸»æœºç»„å-ä¸»æœºæ¸…å•åœ°å€-æ¨¡å—å-æ¨¡å—å‚æ•°ï¼‰*2ï¼ˆæ‹·è´åˆ°nignxç›®å½•+æˆæƒï¼‰-ä¿å­˜
ç‚¹å‡»æ„å»º







PHP ä¸èƒ½ç‹¬ç«‹å¤„ç† Web æœåŠ¡å’Œé™æ€èµ„æº
tomcatï¼š å¤„ç† é™æ€é¡µé¢ï¼ˆHTMLã€CSSã€JSï¼‰+å¤„ç†Web åŠ¨æ€è¯·æ±‚ï¼š
tomcat+Nginxï¼š
åšåå‘ä»£ç† 
æå‡é™æ€èµ„æºè®¿é—®æ€§èƒ½
æä¾›è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰åŠŸèƒ½

phpä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼š
php.ini
	PHP çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œæ§åˆ¶ PHP çš„æ•´ä½“è¡Œä¸º
php-fpm.conf æˆ– pool é…ç½®æ–‡ä»¶
	PHP-FPM ä¸“ç”¨é…ç½®æ–‡ä»¶ï¼Œç”¨äºæ§åˆ¶ PHP-FPM è¿›ç¨‹æ± è¡Œä¸º
```

-----ç›‘æ§

### prometheus

	æ ¸å¿ƒç»„ä»¶
```
server
exporter
promsql
alertmanager
grafana
```
![image-20251014142136469](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014142136469.png?lastModify=1760942787)

	å·¥ä½œæ¨¡å¼ï¼šæ‹‰å–æ¨é€

![image-20251014142322070](file:///C:/Users/chen2/AppData/Roaming/Typora/typora-user-images/image-20251014142322070.png?lastModify=1760942787)
ç‰ˆæœ¬ï¼šPrometheus 3.5
### zabbix
	ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼šä¸»è¢«åŠ¨
	ç«¯å£ï¼š
	
![[Pasted image 20251020151412.png]]
	
	ç‰ˆæœ¬ï¼šZabbix 7.0 LTSæˆ–Zabbix 6.0 LTS
	æŠ¥è­¦åª’ä»‹ï¼šé’‰é’‰ã€é‚®ç®±

-----ä¼ä¸šåº”ç”¨

### ELK
	æ¶æ„
### hadoopã€kafka
ä¼šæ­å»ºï¼ŒçŸ¥é“æœ‰ä»€ä¹ˆç”¨å°±è¡Œ


-----å¹³å°ç®¡ç†
è‡ªåŠ¨åŒ–å·¥å…·

### ansible
	 å‘½ä»¤æ ¼å¼

```
æ‰¹é‡éƒ¨ç½²ä¸é…ç½®ç®¡ç†
ansible <ä¸»æœºç»„> -m <æ¨¡å—> -a "<å‚æ•°>" [
```
	 æ¨¡å—
```
ping  
command / shell  å‘½ä»¤æ‰§è¡Œç±»
copy/fetch/file  æ–‡ä»¶ç®¡ç†
yum/ apt  è½¯ä»¶åŒ…ç®¡ç†
service / systemd
user  ç”¨æˆ·ç®¡ç†

Ansible çš„æ ¸å¿ƒæ˜¯ï¼šInventoryï¼ˆä¸»æœºæ¸…å•ï¼‰ + æ¨¡å—ï¼ˆåŠŸèƒ½ï¼‰ + YAMLï¼ˆå‰§æœ¬)

```
### saltstack
ä¼šæ­å»ºå°±è¡Œ

-----è™šæ‹ŸåŒ–

### kvm

	è™šæ‹Ÿç³»ç»Ÿç®¡ç†å™¨
```
è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆHypervisorï¼‰:
	Type-1ï¼ˆè£¸æœº/åŸç”Ÿï¼‰:VMware ESXiã€Xenã€Hyper-V
	Type-2ï¼ˆæ‰˜ç®¡/å®¿ä¸»æœºï¼‰:VirtualBoxã€VMware Workstation
KVM æ˜¯ Linux å†…æ ¸è‡ªå¸¦çš„è™šæ‹ŸåŒ–æ¨¡å—
qeumå·¥ä½œåœ¨ç”¨æˆ·å±‚ï¼Œkvmå·¥ä½œåœ¨å†…æ ¸å±‚
è™šæ‹Ÿç³»ç»Ÿç®¡ç†å™¨ï¼ˆå›¾å½¢åŒ–ï¼‰:ç®¡ç†è™šæ‹Ÿæœº
```
	åŠ¨æ€è¿ç§»
```
è™šæ‹Ÿæœºç£ç›˜æ”¾åœ¨å…±äº« NFS
æ‰“å¼€ virt-managerè™šæ‹Ÿç³»ç»Ÿç®¡ç†å™¨ï¼Œå³é”®è™šæ‹Ÿæœº â†’ è¿ç§»
é€‰æ‹©ç›®æ ‡ä¸»æœº â†’ ç‚¹å‡»ç¡®è®¤
virt-manager è°ƒç”¨ libvirt/QEMU å®Œæˆ å†…å­˜ + CPU çŠ¶æ€è¿ç§»
è™šæ‹Ÿæœºåœ¨ç›®æ ‡ä¸»æœºç»§ç»­è¿è¡Œï¼Œç”¨æˆ·å‡ ä¹æ„ŸçŸ¥ä¸åˆ°åœæœº
```

### docker
	å‘½ä»¤
```
é•œåƒ
pullã€save -oã€load -iã€imagesã€inspectã€tagã€rmiã€
å®¹å™¨
ps -a
docker create [é€‰é¡¹] é•œåƒ [COMMAND] [ARG...]
docker run [OPTIONS] IMAGE [COMMAND ] [args]
run -it /bin/bashã€
exec -it /bin/bash
docker exec -it å®¹å™¨ID/å®¹å™¨å /bin/bash
start/stop/pause/unpause/restart
docker exec å®¹å™¨ å‘½ä»¤
docker run --rm <é•œåƒ> <å‘½ä»¤>
-p 192.168.80.13:81:80
docker port
docker logs
docker volume ls
-v /data  /data:/abc  æ–‡ä»¶æŒ‚è½½  åªè¯»æŒ‚è½½

docker export å®¹å™¨ID/åç§°>æ–‡ä»¶å
docker import /opt/test.tar test:v1
docker rename
docker stats
docker top
docker kill
docker rm
docker cp /root/anaconda-ks.cfg å®¹å™¨å:/tmp
-e
-m 512M
-cpus 2 --cpuset-cpus 0,1
--device
```
	é•œåƒåˆ¶ä½œå‘½ä»¤
```
dockerfileï¼šå®šä¹‰é•œåƒçš„æ„å»ºæ­¥éª¤
FROM
MAINTAINER/LABEL

COPY
ADD: urlä¸‹è½½æ–‡ä»¶ä¸è§£å‹,addå¯ä»¥è‡ªåŠ¨è§£å‹ä¸€äº›æœ¬åœ°å‹ç¼©æ–‡ä»¶

RUN: buildè¿‡ç¨‹ä¸­è¿è¡Œ
CMD: è¿è¡Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶
ENTRYPOINT: æŒ‡å®šé»˜è®¤ç¨‹åº,ä¸ä¼šè¢«docker runå‘½ä»¤æŒ‡å®šçš„å‚æ•°æ‰€è¦†ç›–

USER: æŒ‡å®šè¿è¡Œdockerfileæ„å»ºçš„imageçš„ç”¨æˆ·åæˆ–UID
WORKDIR: è®¾ç½®å·¥ä½œç›®å½•ç›¸å½“äºä¸€æ¬¡æ€§çš„cd
VOLUME: åœ¨imageä¸­åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ç›®å½•,æŒ‚è½½å¤–éƒ¨å·
EXPOSE: æ‰“å¼€æŒ‡å®šè¦ç›‘å¬å‘ç«¯ï¼Œå¤šä¸ªç«¯å£ç©ºæ ¼éš”å¼€
ENV: å®šä¹‰ç¯å¢ƒå˜é‡

å‘½ä»¤ï¼š
	docker build -t é•œåƒå .dockerfileå’Œæ–‡ä»¶åœ¨ç›¸åŒç›®å½•
```
	ç½‘ç»œæ¨¡å‹
```
--net=host/container:å®¹å™¨id/none/bridgeï¼ˆé»˜è®¤ï¼‰
hostï¼šå’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ªNetwork Namespaceï¼›ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£
containerï¼šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªNetwork Namespace
noneï¼šä¸ä¸ºDockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®


bridgeï¼šå±äºä¸€ç§NATç½‘ç»œæ¨¡å‹
å®¿ä¸»æœºçš„è™šæ‹Ÿç½‘æ¡¥ï¼ˆdocker0ï¼‰
è™šæ‹Ÿç½‘ç»œæ¥å£ä¸€ç«¯åœ¨å®¹å™¨çš„Network Namespaceï¼Œå¦ä¸€ç«¯åœ¨docker0
- å®¹å™¨è®¿é—®å¤–ç½‘æ—¶ï¼š
     é€šè¿‡ **NAT**ï¼ˆMASQUERADEï¼‰ç”±å®¿ä¸»æœºè½¬å‘åˆ°å¤–ç½‘ã€‚   
- å¤–éƒ¨è®¿é—®å®¹å™¨ï¼š
    - éœ€è¦ **ç«¯å£æ˜ å°„**ï¼ˆ`-p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£`ï¼‰ï¼Œå¦‚ï¼š
        docker run -d -p 8080:80 nginx`
bridgeå°±æ˜¯==å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿç½‘æ¡¥ + NAT
```
	harbor
	
### K8S
```
Kubernetesï¼ˆK8sï¼‰ æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œç”¨äº è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨
å®¹å™¨ç¼–æ’å’Œè°ƒåº¦ã€è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHorizontal / Verticalï¼‰ã€è‡ªæ„ˆèƒ½åŠ›ï¼ˆè‡ªæˆ‘ä¿®å¤ã€é‡å¯ã€è¿ç§»ï¼‰ã€ç»Ÿä¸€ç®¡ç†é›†ç¾¤èµ„æº

æ¶æ„æ¦‚è§ˆ
	ä¸»ä»å¼ï¼ˆMasterâ€“Nodeï¼‰æ¶æ„

Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶å¹³é¢ï¼‰ï¼šAPI Serverã€etcdã€Scheduleã€Controller Managerï¼ˆdeploymentã€replicasetï¼‰å®ç°è‡ªæ„ˆå’ŒçŠ¶æ€ç®¡ç†

Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰ï¼šKubeletã€Kube-Proxyã€Container Runtimeã€cAdvisor


é™„åŠ ç»„ä»¶ï¼š
ingress Controller
CoreDNS / kube-dns
Dashboard
Helm

èµ„æºå¯¹è±¡ï¼š
podã€deploymentã€serviceã€æŠ½è±¡ç½‘ç»œæ¥å£ã€namespaceã€configmap/secretã€volume

ç”¨æˆ·æˆ– CI/CD é€šè¿‡ API Server ä¸‹å‘ YAML æ–‡ä»¶ï¼ˆåˆ›å»º Deploymentã€Service ç­‰ï¼‰
Scheduler æ ¹æ®èµ„æºæƒ…å†µå†³å®š Pod è°ƒåº¦åˆ°å“ªå° Node
Kubelet åœ¨ Node ä¸Šåˆ›å»ºå®¹å™¨ï¼Œé€šè¿‡ Runtime å¯åŠ¨
Controller ç¡®ä¿å‰¯æœ¬æ•°é‡ã€çŠ¶æ€ä¸æœŸæœ›ä¸€è‡´ï¼ˆè‡ªæ„ˆï¼‰
Kube-Proxy / Ingress è´Ÿè´£ç½‘ç»œè®¿é—®å’Œè´Ÿè½½å‡è¡¡



kubectlæ˜¯ Kubernetes çš„ *å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œé€šè¿‡ API Server*ä¸é›†ç¾¤é€šä¿¡

kubectl apply -f æ˜¯ å£°æ˜å¼ç®¡ç†èµ„æºçš„æ ¸å¿ƒæ–¹å¼ã€‚


Kubernetes çš„èµ„æºæ“ä½œ æ—¢å¯ä»¥é€šè¿‡ YAML ä¸‹å‘ï¼ˆå£°æ˜å¼ï¼‰ï¼Œä¹Ÿå¯ä»¥ é€šè¿‡ kubectl å‘½ä»¤è¡Œç›´æ¥åˆ›å»º/ä¿®æ”¹ï¼ˆå‘½ä»¤å¼ï¼‰ã€‚
å£°æ˜å¼é€‚åˆæŒç»­äº¤ä»˜/ç‰ˆæœ¬æ§åˆ¶ï¼Œå‘½ä»¤å¼é€‚åˆå¿«é€Ÿæ“ä½œã€æµ‹è¯•å’Œä¸´æ—¶ç®¡ç†ã€‚
ä¸¤è€…åº•å±‚åŸç†éƒ½æ˜¯é€šè¿‡ API Server æ¥æ”¶è¯·æ±‚ â†’ æ›´æ–° etcd â†’ Controller/Kubelet æ‰§è¡Œæ“ä½œ

pod å†…å¤šä¸ªå®¹å™¨å…±äº«ä¸€å¥—ç«¯å£ç³»ç»Ÿï¼Œå¿…é¡»é€šè¿‡ç«¯å£åŒºåˆ†å®¹å™¨

```


