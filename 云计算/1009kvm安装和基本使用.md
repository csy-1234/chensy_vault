---
date: "20251009"
docx:
  - 1-KVM虚拟化安装和基本使用.docx
实验: 未做
---
[1-KVM虚拟化安装和基本使用.docx](附件/虚拟化/1-KVM虚拟化安装和基本使用.docx)
 
# KVM虚拟化安装和基本使用
## 笔记
==kvm虚拟化==

==kvm虚拟化平台的硬件要求==

==KVM 安装方式==

==设置KVM网络==

==KVM管理工具virt-manager==

==KVM 基本功能管理==


## 课外
==虚拟化是什么？==
就是在物理机资源之上虚拟出多个虚拟机

虚拟机（Virtual Machine, VM）是由 **Hypervisor** 创建的一组“虚拟化硬件资源”，  
它模拟了一台完整的计算机的 **硬件环境**：

|类别|虚拟化后对应物|
|---|---|
|CPU|vCPU（虚拟CPU）|
|内存|vRAM（虚拟内存）|
|硬盘|虚拟磁盘文件（通常是 .qcow2、.vmdk 等）|
|网卡|虚拟网卡（vNIC）|
|BIOS / 主板 / 控制器|都由 Hypervisor 模拟|

---

⚙️ 虚拟机创建时的状态

当你“创建虚拟机”时，实际上只是定义了一套**虚拟硬件配置**：

`虚拟机定义文件（如 XML、VMDK） ├── CPU 数量：2 ├── 内存大小：4GB ├── 磁盘：/var/lib/libvirt/images/vm1.qcow2 ├── 网卡：桥接到 br0 └── 启动介质：/iso/CentOS-7.iso`

这时虚拟机还**没有操作系统**，  
你启动后通过 ISO 镜像（相当于虚拟光驱）去**安装操作系统**，  
安装完 OS 之后，它才成为一个“完整可运行的虚拟机实例”。

==kvm和虚拟化的关系？==
虚拟化有三层，第一层是**Hypervisor**，用于创建vm；
第二层是云管理平台，管理vm；
第三层是容器 / 应用平台

所以：KVM 是虚拟化的底层实现（第一层）；

==kvm与qemu的关系？==

kvm用于linux的os之上的虚拟化、kvm提供**硬件加速，不能单独使用**，需结合qeum或其他管理工具，
qeum或其他管理工具，提供·**软件模拟功能**；
提供两种组合，
	单独的qemu
	两者结合使用（qeum工作在用户层，kvm工作在内核层）；
	另外一种是vmwareworksation运行在linux或windows上，提供虚拟化功能；
还有一种是运行在纯裸机上，不运行在linux或windows

KVM **确实不是“完全裸机”层**（不像 VMware ESXi 那种完全独立的 Hypervisor 系统），  
而是 —— **“基于 Linux 内核的裸机虚拟化”**

==KVM的两种网络建立？==

💯完全正确，你的理解非常到位，而且表达得已经接近网络工程师的层次了。  
我帮你把这两种模式的核心机制再凝练一下，用更形象的方式对比总结 👇

---

## 🧱 NAT 模式：内外网隔离 + IP 转换（SNAT）

```
外部网络（192.168.80.x）
          │
     ens33（192.168.80.138）
          │
     ┌─────────────┐
     │ NAT转换 + DHCP │ ← libvirt/dnsmasq 自动创建
     └─────────────┘
          │
     virbr0（192.168.122.1）
          │
   虚拟机 eth0（192.168.122.2）
```

🔹 工作逻辑：

- **ens33**：物理网卡，持有真实 IP（外网/宿主机 IP）；
    
- **virbr0**：虚拟网桥（libvirt 自动创建），内部网段 192.168.122.0/24；
    
- **libvirt/dnsmasq** 提供虚拟 DHCP + NAT；
    
- 虚拟机访问外网时，**NAT 把虚拟机 IP 转换为宿主机 ens33 的 IP**。
    

🔸 本质：

> ens33 负责外网通信，  
> virbr0 是一个“虚拟路由器”，  
> 它把虚拟机的内网流量转成外网流量。

🧠 因此，**ens33 不需要两个 IP**，  
因为“内网”在 virbr0 上完成，  
ens33 只负责 NAT 后的外部通信。

---

## 🌉 桥接模式：同网段直通，不做 NAT

```
外部网络（192.168.80.x）
          │
        ens33（无 IP）
          │
        br0（192.168.80.138）
          │
     ┌────────────┐
     │ 虚拟交换机 │ ← 把流量桥接分发
     └────────────┘
          │
  虚拟机 eth0（192.168.80.139）
```

🔹 工作逻辑：

- **br0**：虚拟网桥（桥接接口），有真实 IP；
    
- **ens33**：不再配置 IP，只是桥的一部分，像一根“网线”；
    
- 虚拟机的网卡（vNIC）也接入 br0；
    
- 所有设备（宿主机 + 虚拟机）在同一网段（192.168.80.x）；
    
- 外部物理路由器（例如 192.168.80.1）直接做网关。
    

🔸 本质：

> br0 = 虚拟交换机  
> ens33 = 实体网线  
> 虚拟机与宿主机共享同一个广播域，没有 NAT。

---

## 🧭 总结对比

|特性|NAT 模式|桥接模式|
|---|---|---|
|是否做 NAT|✅ 是（内外网转换）|❌ 否|
|虚拟网桥|virbr0（自动）|br0（手动）|
|ens33 是否有 IP|✅ 有（宿主机 IP）|❌ 无（交给 br0）|
|虚拟机 IP 网段|内网私有段（如 192.168.122.x）|与宿主机同网段（如 192.168.80.x）|
|虚拟机访问外网方式|通过宿主机 NAT 转换|直接通过外部网关|
|适合场景|测试环境、本地隔离|生产环境、服务器直连|

---

✅ **一句话总结你刚才说的非常准确：**

> NAT 模式是“虚拟网桥 + NAT 做内外网转换”；  
> Bridge 模式是“虚拟网桥接管物理网卡，所有设备同网段通信”。
