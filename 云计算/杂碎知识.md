# nginx变量来源：

### 1. **请求相关变量**（你已熟悉的）

- 请求行：`$request_method`, `$request_uri`, `$args`
    
- 请求头：`$http_*` 系列
    
- 请求体：`$content_length`, `$request_body`
    

### 2. **连接相关变量**

这些变量描述客户端与 Nginx 的连接状态：

|变量名|说明|实例|
|---|---|---|
|`$remote_addr`|客户端 IP 地址|`192.168.1.100`|
|`$remote_port`|客户端端口号|`54321`|
|`$server_addr`|服务器 IP 地址|`10.0.0.5`|
|`$server_port`|服务器端口号|`80`, `443`|
|`$connection`|连接序列号|`12345`|
|`$connection_requests`|当前连接已处理的请求数|`3`|
|`$tcpinfo_rtt`|TCP 往返时间|`150`|

### 3. **响应相关变量**

这些变量在生成响应时有用：

|变量名|说明|实例|
|---|---|---|
|`$status`|HTTP 状态码|`200`, `404`, `502`|
|`$body_bytes_sent`|发送的响应体字节数|`2048`|
|`$bytes_sent`|发送的总字节数|`3120`|
|`$sent_http_*`|发送的响应头|`$sent_http_content_type`|

### 4. **Nginx 核心配置变量**

这些变量直接来自 Nginx 配置：

| 变量名                  | 说明             | 实例              |
| -------------------- | -------------- | --------------- |
| **`$document_root`** | 当前根目录路径        | `/var/www/html` |
| **`$realpath_root`** | 根目录的绝对路径       | `/var/www/html` |
| **`$server_name`**   | 匹配的 server 块名称 | `example.com`   |
| **`$nginx_version`** | Nginx 版本号      | `1.18.0`        |

### 5. **时间相关变量**

|变量名|说明|实例|
|---|---|---|
|`$time_iso8601`|ISO8601 格式时间|`2023-10-15T14:30:00+08:00`|
|`$time_local`|本地时间格式|`15/Oct/2023:14:30:00 +0800`|
|`$msec`|当前时间（秒+毫秒）|`1697351400.123`|

### 6. **代理/上游相关变量**

在使用 `proxy_pass` 时特别有用：

|变量名|说明|实例|
|---|---|---|
|`$proxy_host`|代理的上游主机|`backend.example.com`|
|`$proxy_port`|代理的上游端口|`8080`|
|`$upstream_addr`|上游服务器地址|`10.0.1.2:8080`|
|`$upstream_status`|上游响应状态码|`200`|
|`$upstream_response_time`|上游响应时间|`0.005`|
|`$upstream_cache_status`|缓存状态|`HIT`, `MISS`, `EXPIRED`|

### 7. **SSL/TLS 相关变量**

用于 HTTPS 连接：

|变量名|说明|实例|
|---|---|---|
|`$https`|是否 HTTPS 连接|`on`, `""`|
|`$ssl_protocol`|SSL 协议版本|`TLSv1.2`|
|`$ssl_cipher`|加密套件|`ECDHE-RSA-AES256-GCM-SHA384`|
|`$ssl_client_verify`|客户端证书验证结果|`SUCCESS`|

### 8. **地理位置变量**

需要 `ngx_http_geoip_module` 模块：

|变量名|说明|实例|
|---|---|---|
|`$geoip_country_code`|国家代码|`CN`, `US`|
|`$geoip_country_name`|国家名称|`China`|
|`$geoip_city`|城市名称|`Beijing`|

### 9. **自定义变量**

用户自己定义的变量：

